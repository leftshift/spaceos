_log_entries = {
	{
		title="[1: LOG RESET]",
		text=[[Operator: #5932
Action: log reset
Reason: vehicle decomissioned
Auth: #238492
<EOM>]]
	},
	{
		title="[2: OWNER TRANSFER]",
		text=[[Operator: #5932
Action: chown
Old owner: <REDACT>
New owner: IR TRADE
Auth: #238493
<EOM>]]
	},
	{
		title="[3: repair report 1]",
		text=[[Operator: #1
Type: Mission Log

rusty, scraped up, still beautiful. TMS Grey, decomissioned military ship.
And now it's ours.
The state on Losa is tensing up, we should hurry.]]
	},
	{
		title="[4: Mining on Losa]",
		text=[[Type: Copy
Source: GWA HC
 
The Galactic Welfare Association has chosen the planet Losa as a site for Isnium mining to meet increasing demands for power.
A new noninvasive scheme will be used.
Inhabitants are advised to comply.

GWA High Command.]]
	},
	{
		title="[5: New mining tech]",
		text=[[Type: Copy
Source: Tech Report!
 
Mining tech evolves:
Losa has been selected as the site of a new procedure called suboceanic noninvasive mining.
Big machinery grazes over the ocean floor, taking off about 100 blocks of material, extracting the Isnium and depositing the rest back into the sea.
Critics say this may disrupt the ecosystem forever.]]
	},
	{
		title="[6: Shore's riddle]",
		text=[[Type: Copy
Source: The Post

The number of dead landards and geera washed up on the shores of Losa had continuosely increased over the last few months. The reasons are still unclear.
Some worry because of the role the fish play for the climate.]]
	},
	{
		title="[7: repair report 2]",
		text=[[Operator: #1
Type: Mission Log

I've added some press reports and bulletins, as evidence for what the so-called welfare alliance (pfft, what a name) has done to Losa.

Shields fixed, cargo hold cleaned, new galley, dimensional drive still wonky]]
	},
	{
		title="[8: Geera Statement]",
		text=[[Type: Copy
Source: GWA EPA

Reports of rising numbers of dead fish are misleading.
There has always been dead geera on the shores of Losa, the numbers have converged to a stable level, similar to before the mining operation started.

Any attemts to smear this necessary project are plainly attemted sabotage.
GWA Env. Prot.]]
	},
	{
		title="[9: Coldest Winter]",
		text=[[Type: Copy
Source: Morning Type
 
Already, this winter is the coldest in recorded history on planet Losa.

The Galactic Welfare Alliance is under fire for failing to address inhabitants' concerns about environmental changes which coincide with the large-scale mining of precious Isnium which is extracted from the 93% of surface covered by oceans. The cooling climate may further destabilise an already wounded ecosystem, activists warn.]]
	},
	{
		title="[10: Status]",
		text=[[Type: System Status
System: Nav
Status: Online]]
	},
	{
		title="[11: repair rep. 3]",
		text=[[Operator: #1
Type: Mission Log

Cries for help from Losa.
Overcrowded shuttles.
Fear, uncertainty.
We'll be on our way.
Be strong, be resiliant.

Be loving.]]
	},
	{
		title="[12: Losa shuttles]",
		text=[[Type: Copy
Source: GWA TA

Due to a technical defect at the port, planetary shuttles can't service Planet Losa at the moment.
We regret any inconvenience.
Services are expected to continue in about 1 week(s).

GWA Transport Agency]]
	},
	{
		title="[13: embarking]",
		text=[[Operator: #2
Type: Mission Log

Well, I can't only let Nate write cryptic stuff into this log. (love ya though!)

Probably the kindest crew this ship has ever seen.
Inspiring how many people volunteered to be part of this mission.
Doctors, scientists, cooks, teachers, librarians, pilots.
We'll depart the day after tomorrow.

Coudn't quite restore TMS Grey to their former glory, the dimensional drive has some issues, but it should be safe enough to make it to Losa and back.
Ahoy, fingers crossed.]]
	},
	{
		title="[14: departure]",
		text=[[Operator: #1
Type: Mission Log

Registered as a trade shipment, departed, had nice dinner, finishing the beds in the cargo hold right now.

Headed for a settlement that can't be reached by land, only by shuttle. They're running out of food. And aren't heard.]]
	},
	{
		title="[15: Status]",
		text=[[Type: System Status
System: Fire Supp.

Area: Galley
Status: Extinguisher activated.]]
	},
	{
		title="[16: approach]",
		text=[[Operator: #2
Type: Mission Log

Oops, had a small mishap in the galley yesterday, luckily noone was hurt.

We're cleared to land at
St. Turing, where we will arrive later tomorrow.]]
	},
	{
		title="[17: departure]",
		text=[[Operator: #1
Type: Mission Log

chaotic, sad, powerless.
The ship is at capacity.
So many we had to leave behind.
Situation worse than we anticipated, even though we knew the GWA was downplaying.
We'll come again.
Stay strong.
Ahoy to a safe return.]]
	},
	{
		title="[18: witness 1]",
		text=[[Operator: #3
Type: Mission Log

My name is Franka. I lived in the Settlement of St. Turing my whole life.
Life was tough up in the mountains since the gold mines were closed, 7 years ago.
Most folk left, some started farming. Most buildings fell into disrepair, since the material shuttles stopped after the gold.
But since about 4 months ago, life became almost unbearable.
The gruesome winter killed even the non-seasonal crops, and spring never came.
Our stocks are empty.
Almost noone heared our cries for help. After the gold, the Alliance classified the mountains as uninhabitable and stopped all support except the rare shuttles they are obliged to run.

But this is our home.
Where I grew up,
made friends
found love,
painted,
hiked,
lived.
I hope to return.]]
	},
	{
		title="[19: tired, glad]",
		text=[[Operator: #1
Type: Mission Log

the title says it.
caring for so many people,
many malnourished,
injured,
struggeling emotionally,
hungry.
But also very creative.
Writing music, paining lessons, poetry.
So much more meaningful than any thing I've ever done. Writing into this log feels pointless seenig what else there is to do.]]
	},
	{
		title="[20: poem]",
		text=[[Operator: #4
Type: Mission Log

traded:
cooked to reheated
burbling to reclaimed
free to fleeing
house to bed, crate
death to life?
resentful deal.]]
	},
	{
		title="[21: Inquiry]",
		text=[[Type: Message
From: GWA Customs

Please submit tariff form 39 for cargo loaded on Losa.
Note providing incorrect data will be punished. Cargo  may be inspected on arrival to ensure safety of the destination planet.

GWA Customs]]
	},
	{
		title="[22: recipe]",
		text=[[Operator: #5
Type: Mission Log

Recipe for landard Soup:
1 big landard
2 ka'hn
2 sticks of grigweed
pinch of ling
sudplant (garnish)

Fry ka'hn on high heat.
Add water.
Cut landard into byte-sized pieces. Add landard and grigweed to pot.
Boil with lid for 3-4 hours.
Season with ling.

Serve in big mugs or other soup container.
Garnish with one sudplant.
Enjoy!]]
	},
	{
		title="[23: landing]",
		text=[[Operator: #2
Type: Mission Log

Almost back home.
Well, it's home for us and will hopefuly become a home for our guests as well, be it just a temporary one.

As we are landing on Hopper Island, we hope the GWA will not interfere.]]
	},
	{
		title="[24: Coldest Summer]",
		text=[[Type: Copy
Source: Morning Type

After a cruel winter on Losa, the temperatures continued to stay negative.
Inhabitants who were just struck by the coldest winter are struggling to make ends meet:
Only about 5% of fields can be used, the rest is in areas where even the most robust crops cannot grow at the current temperatures.
The other source of nutrients, fish, is also mostly cut off. In addition to the spike in dead fish for unexplained reasons, many rivers and parts of the ocean are frozen, making fishing close to impossible and further hurting the ecosystem.
Many who try to leave are hindered by the current lack of shuttles.]]
	},
	{
		title="[25: offload, start]",
		text=[[Operator: #1
Type: Mission Log

got everyone off safely.
No time to loose, the GWA will only get more devious.
They probably know what we are doing. Still have to try.
We'll leave again in 2 days.
Need to fix a few things till then.]]
	},
	{
		title="[26: Disease]",
		text=[[Type: Copy
Source: The Watch

An unknown disease has started to affect some domesticated animals on Planet Losa.
Some described symptoms are disorientation, unrest and other changes in behaviour.
It is unknown whether it is infectious for other, often falsely classified as intelligent, organisms.]]
	},
	{
		title="[27: worry]",
		text=[[Operator: #2
Type: Mission Log

We kind of believe this virus thing to be some lie of the GWA, as none of the people we took from Losa knew anything about it.
Either way, this makes the situation a lot harder and more dangerous.
But we'll return.]]
	},
	{
		title="[28: Quarantine]",
		text=[[Type: Copy
Source: GWA EPA

Due to a new class of virus, Losa has been put under quarantine for the safety of both the galaxy and the inhabitants of Losa.

Shuttle services will stay suspended indefinitely.
All ships leaving Losa must register with EPA immediately.
Thank you for your cooperation.
GWA Env. Prot.]]
	},
	{
		title="[29: departure]",
		text=[[Operator: #1
Type: Mission Log

Restocked. Scared.
Back to Losa anyways
Because if not us,
whoever else?]]
	},
	{
		title="[30: Inquiry]",
		text=[[Type: Message
From: GWA Customs

Please report destination.
Note: Travel to Losa only with written Permit.
Otherwise, your ship will be intercepted for your own safety.

GWA Customs]]
	},
	{
		title="[31: shut up]",
		text=[[Operator: #2
Type: Mission Log

Fuck the GWA. 'Our own safety' - bullshit. They just want their Isnium, if they kill a whole fucking planet - oops, but it's for the 'greater good' as they love to say.

They won't get us down.
We're doing what's right.]]
	},
	{
		title="[32: Status]",
		text=[[Type: System Status
System: Dim. Drive

Status: Unexpected
offset [0, -3f, 2a]
Hint: Check cooling]]
	},
	{
		title="[33: Status]",
		text=[[Type: System Status
System: Nav

Status: Reaquired positional lock after 13s.]]
	},
	{
		title="[34: oops]",
		text=[[Operator: #1
Type: System Log

Damn, that was quite the jolt.
We were probably pushing the speed a bit too much considering the age of this ship.
We're only slightly off course.]]
	},
	{
		title="[35: tired]",
		text=[[Operator: #6
Type: Mission Log

Hey, uh, I'm Lis.
Don't really know how to write mission logs, but w/e.
I already was part of the first mission and most people stayed for the second one, although it was a hasty decision to go right back to Losa.
And I don't think I could do it a third time.

The biggest thing I learned was how much I love feeling at home somewhere, and what a privilege that is.
And even though I know what is happening to the people we rescued, I can't to the slightest know what it must feel like.]]
	},
	{
		title="[36: landing]",
		text=[[Operator: #2
Type: Mission Log

Arrived back on Losa at Worsley Town, remote fishing town that has been hit hard by the near extinction of fish.
Some have already started the long hike across the mountains to the bigger settlements, but many would probably not make it there before winter.
Although summer, winter, kind of the same thing here now.

We'll be a bit overcrowded, but we won't leave anyone behind.
Almost ready to go again, we'll try to leave tomorrow.]]
	},
	{
		title="[37: departure]",
		text=[[Operator: #1
Type: Mission Log

Guess we found the limit of how many people fit on here.

I'm literally sleeping on the bridge now because there's not anywhere else left.]]
	},
	{
		title="[38: Inquiry]",
		text=[[Type: Message
From: GWA Customs

Note you have knowingly transgressed the quarantine of Losa.
Expect no further patience from us.]]
	},
	{
		title="[39: witness 2]",
		text=[[Operator: #7
Type: Mission Log

My emotions cold.
Haven't quite realised what even happened.
Now I'm on this ship and I don't even know if I wanted to.
Everyone left so I kind of came along. But maybe I should have stayed, died peacefully.
It's just a disgrace how they ruined the future of my grandkids.
Treat us like a disease-laden pest, yet noone has actually died from said virus. They just starve to death. Simple and sad as that.

And while they ruled our death sentence by taking away the shuttles they just continue harvesting our oceans and stealing our goods like nothing happened.

I just beg the children will have a good future,
somewhere,
somehow.]]
	},
	{
		title="[40: they're here]",
		text=[[Operator: #1
Type: Mission Log

Ships have been closing in on us.

They ident as customs ships, but they sure look a lot more like fighters to me.
Hard to predict what they'll do. They won't have capacity to arrest all of us, so they'll probably try to take over the ship... or...

I don't even want to think about it.

We don't really have any options, they're faster than us.]]
	},
	{
		title="[41: Order]",
		text=[[Type: Message
From: GWA HC

Stop your ship immediately for customs investigation.

Otherwise, force may need to be used to ensure the uphold of the quarantine.]]
	},
	{
		title="[42: slow down]",
		text=[[Operator: #2
Type: Mission Log

We don't really have a choice.
We can't risk so may lifes.

Although, who knows what they will do to us.

We need to come up with something.]]
	},
	{
		title="[43: boxed in]",
		text=[[Operator: #1
Type: Mission Log

Well, here we are.
TMS Grey, our dainty ship, next to G73H8, a not so dainty fighter.

Appears they only have orders to stop us, not for what's next.]]
	},
	{
		title="[44: overclock]",
		text=[[Operator: #6
Type: Mission Log

Now, this could be a very bad idea, but we're kind of out of ideas, period.

On the way here, the dimesional drive overheated, warping us quite a bit.
Now, I know that research on this has been suspended as viable teleportation tech, as it's just too unpredictable, but maybe it's enough.]]
	},
	{
		title="[45: Status]",
		text=[[Type: System Status
System: Dim. Drive

Status: Unexpected
offset [3a, -7f, 9f]
Hint: Check cooling]]
	},
	{
		title="[46: Status]",
		text=[[Type: System Status
System: Dim. Drive

Status: Unexpected
offset [??, ??, ??]
Hint: Check cooling]]
	},
	{
		title="[47: Status]",
		text=[[Type: System Status
System: Nav

Status: No known celestrial objects.

Could not aquire lock.]]
	},
	{
		title="[48: what]",
		text=[[Operator: #1
Type: System Log

Well that worked a a bit too well.
Neither me nor the nav system have any idea where in the universe we ended up.
But surprisingly, instead of vast nothingness (the more likely option), I can see a Planet and a Star.

The dimensional drive also ate up absurd amounts of fuel for this jump, so we probably won't get much further.]]
	},
	{
		title="[49: analysis]",
		text=[[Operator: #7
Type: System Log

Not sure if I would call stranding somewhere unknown a lucky day, but it appears this close planet has a breathable atmosphere, be it a bit less rich than what we're used to.
Also, the temperatures look alright.]]
	},
	{
		title="[50: decisions]",
		text=[[Operator: #1
Type: Mission Log

Well, landing on an unknown planet sounds like an awful plan, but it certainly sounds better than never landing anywhere ever again.

I think most of us have not quite realised we may never see our homes again.
It seems like a thought too big to fit into one single mind.

But we still will have to live with it.
Well, if we survive the landing, otherwise all our worries don't really matter]]
	},
	{
		title="[51: poem]",
		text=[[Operator: #8
Type: Mission Log

If I write something
into a mission log,
and there's no one
to read it,
is it still art?]]
	},
	{
		title="[52: painting]",
		text=[[Operator: #9
Type: Mission Log

     \   /   
      ooo
     OOOOO
      ooo]]
	},
	{
		title="[53: final approach]",
		text=[[Operator: #2
Type: Mission Log

Let's hope for the best.
About to enter the atmosphere.]]
	},
	{
		title="[54: Status]",
		text=[[Type: System Status
System: Landing

Status: Parachutes deployed]]
	},
	{
		title="[55: Status]",
		text=[[Type: System Status
System: Camouflage

Status: Camouflage deployed.
Found features: fluid, food, enclosure.]]
	},
	{
		title="[56: landed]",
		text=[[Operator: #2
Type: System Log

Rough landing. Just a few scrapes luckily.
Concidering we landed on trees, the camouflage mostly has comedic effect instead of hiding us, but so far, no signs of life on this planet.
Ships power is almost out, so not sure how long we can update this log. So, if this is it, farewell!]]
	},
}

function string:split(delimiter)
  local result = { }
  local from  = 1
  local delim_from, delim_to = string.find( self, delimiter, from  )
  while delim_from do
    table.insert( result, string.sub( self, from , delim_from-1 ) )
    from  = delim_to + 1
    delim_from, delim_to = string.find( self, delimiter, from  )
  end
  table.insert( result, string.sub( self, from  ) )
  return result
end

function wrap_line(length, line)
    if (line:len() <= length) then
        return {line}
    else
        local first = string.match(line:sub(1, length+1), "(.*) ")
        local rest = line:sub(first:len() + 2)
        local res = wrap_line(length, rest)
        return {first, table.unpack(res)}
    end
end

function break_lines(width, text)
    lines = {}
    for _, line in ipairs(text:split("\n")) do
        wrapped_lines = wrap_line(width, line)
        for _, subline in ipairs(wrapped_lines) do
            table.insert(lines, subline)
        end
    end
    return lines
end

function paginate(width, height, lines)
    pages = {}

    page = {}
    for i, line in ipairs(lines) do
        if i % (height - 1) == 0 then
            table.insert(pages, page)
            page = {}
        end
        table.insert(page, line)
    end
    if page ~= nil then
        table.insert(pages, page)
    end
    return pages
end


function generate_log(input, width, height)
    new_log = {}
    for i, entry in ipairs(input) do
        new_entry = {}
        new_entry["title"] = entry["title"]
        lines = break_lines(width, entry["text"])
        new_entry["pages"] = paginate(width, height, lines)
        table.insert(new_log, new_entry)
    end
    return new_log
end

new_log = generate_log(_log_entries, 32, 20)

function printLogTable(t)
    print("_log_entries = {")
    for i, entry in ipairs(t) do
        print("\t{")
        print(string.format("\t\ttitle=%q,", entry["title"]))
        print("\t\tpages={")
        for j, page in ipairs(entry["pages"]) do
            print("\t\t\t{")
            for k, line in ipairs(page) do
                print(string.format("\t\t\t\t%q,", line))
            end
            print("\t\t\t},")
        end
        print("\t\t}")
        print("\t},")
    end
    print("}")
end

printLogTable(new_log)
